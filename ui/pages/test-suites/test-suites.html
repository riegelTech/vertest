<main-layout>
    <div>
        <md-button class="md-fab md-primary" @click="showCreatePopin">
           <md-icon>add</md-icon>
        </md-button>
        <md-table v-model="testSuites" md-sort="name" md-sort-order="asc" md-card>
            <md-table-toolbar>
                <h1 class="md-title">Test suites</h1>
            </md-table-toolbar>
            <md-table-row slot="md-table-row" slot-scope="{ item }">
                <md-table-cell md-label="Name" md-sort-by="name">{{ item.name }}</md-table-cell>
                <md-table-cell md-label="Repository" md-sort-by="repositoryName">{{ item.repositoryName }}</md-table-cell>
                <md-table-cell md-label="Git branch" md-sort-by="gitBranch">{{ item.gitBranch }}</md-table-cell>
                <md-table-cell md-label="Action">
                    <md-button class="md-icon-button md-mini md-primary"><router-link :to="`/test-suites/${item._id}`"><md-icon>open_in_new</md-icon></router-link></md-button>
                    <md-button v-if="item.status === 'to_update'" class="md-icon-button md-mini md-accent" @click="solveTestSuiteDiff(item._id)">
                        <md-icon>warning</md-icon>
                    </md-button>
                    <md-button class="md-icon-button md-mini md-accent" @click="deleteTestSuite(item._id)">
                        <md-icon>delete</md-icon>
                    </md-button>
                </md-table-cell>
            </md-table-row>
        </md-table>
    </div>
    <md-dialog :md-active.sync="createPopin.show">
        <md-dialog-title>Please select a repository and a git branch</md-dialog-title>
        <form>
            <md-field>
                <label for="testSuiteName">Test suite name</label>
                <md-input name="testSuiteName" v-model="createPopin.testSuiteName" type="text" />
            </md-field>
            <md-field>
                <label for="repository">Repository</label>
                <md-select v-model="createPopin.selectedRepository" name="repository" @md-selected="selectRepository">
                    <md-option v-for="repository in repositories" :value="repository.address" :key="repository.address">{{ repository.name }}</md-option>
                </md-select>
            </md-field>
            <md-field>
                <label for="gitBranch">Git branch</label>
                <md-select v-model="createPopin.selectedGitBranch" name="gitBranch">
                    <md-option v-for="gitBranch in createPopin.availableGitBranches" :value="gitBranch" :key="gitBranch">{{ gitBranch }}</md-option>
                </md-select>
            </md-field>
            <md-dialog-actions>
                <md-button class="md-primary" @click="sendCreateTestSuite">Import</md-button>
            </md-dialog-actions>
        </form>
    </md-dialog>
    <md-dialog :md-active.sync="diffPopin.show">
        <md-dialog-title>Diff viewer</md-dialog-title>
        <md-tabs v-if="diffPopin.diff !== null" md-dynamic-height>
            <md-tab md-label="Modified">
                <md-content class="md-scrollbar">
                    <div v-for="patch in diffPopin.diff.modifiedPatches">
                        <strong v-if="patch.file === patch.newFile">{{ patch.file }}</strong>
                        <strong v-if="patch.file !== patch.newFile">{{ patch.file }} => {{ patch.newFile }}</strong>
                        <test-case-state :testState="patch.test.status" :displayCurrentState="true" :displayStateSwitch="true" v-on:change-test-status="changeTestStatus"></test-case-state>
                        <diff-viewer :hunks="patch.hunks"></diff-viewer>
                    </div>
                </md-content>
            </md-tab>
            <md-tab md-label="Deleted">
                <md-content class="md-scrollbar">
                    <div v-for="patch in diffPopin.diff.deletedPatches">
                        <strong>{{ patch.file }}</strong>
                        <test-case-state :testState="patch.test.status" :displayCurrentState="true"></test-case-state>
                    </div>
                </md-content>
            </md-tab>
            <md-tab md-label="Added">
                <md-content class="md-scrollbar">
                    <div v-for="patch in diffPopin.diff.addedPatches">
                        <strong>{{ patch.file }}</strong>
                    </div>
                </md-content>
            </md-tab>
        </md-tabs>
    </md-dialog>
</main-layout>